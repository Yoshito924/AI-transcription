# AI文字起こしアプリ

このアプリケーションは、音声や動画ファイルから文字起こしを行い、さらに議事録作成や要約などの追加処理を生成するPythonツールです。

## 対応エンジン

- **Google Gemini API**: クラウドベースの高精度文字起こし（追加処理機能付き）
- **OpenAI Whisper**: ローカル実行可能な無料の文字起こしエンジン（オフライン対応）

## 主な機能

- **音声/動画ファイルの文字起こし**
  - 様々なフォーマット対応（MP3, WAV, MP4, AVI, MOV, M4A, FLAC, OGG）
  - ドラッグ＆ドロップによる簡単ファイル選択
  - 大きなファイルの自動圧縮処理
  - **エンジン選択機能**
    - Gemini（クラウド/高精度）
    - Whisper（ローカル/無料）
  - **Whisperモデル選択**（tiny/base/small/medium/large）
  - GPU自動検出による高速処理（Whisper使用時）

- **2段階処理フロー**
  - 「文字起こし」と「追加処理」の分離
  - 文字起こし結果の再利用が可能
  - API使用の効率化

- **高度なテキスト処理**
  - カスタマイズ可能なプロンプト
  - 議事録作成、要約などの機能
  - マークダウン形式のサポート

- **ユーザーフレンドリーなUI**
  - 処理履歴の管理と閲覧
  - プロンプトの編集・管理
  - 処理状況の可視化

## 必要条件

- Python 3.8以上
- FFmpeg（音声/動画変換用）
- Google Gemini API キー（Geminiエンジン使用時）
- CUDA対応GPU（Whisper高速処理用、オプション）

## インストール

1. リポジトリをクローンまたはダウンロードします
2. 必要なパッケージをインストールします

```bash
pip install -r requirements.txt
```

3. FFmpegをインストールして、パスに追加します
   - Windows: [https://ffmpeg.org/download.html](https://ffmpeg.org/download.html)
   - macOS: `brew install ffmpeg`
   - Linux: `apt-get install ffmpeg`

4. ドラッグ＆ドロップ機能を有効にするには、tkinterdnd2をインストールします
```bash
pip install tkinterdnd2
```

## 使用方法

1. アプリケーションを起動します

```bash
python main.py
```

2. 文字起こしエンジンを選択します
   - **Gemini（クラウド）**: APIキーを設定し、接続確認をします
   - **Whisper（ローカル）**: モデルサイズを選択します（tiny/base/small/medium/large）
3. 音声/動画ファイルをドラッグ＆ドロップまたは選択します
4. 「音声を文字起こし」ボタンをクリックして文字起こしを開始します
5. 処理が完了すると、結果が履歴に表示されます
6. 文字起こし結果を選択して、追加処理（議事録作成、要約など）を実行できます
   - 注：追加処理にはGemini APIが必要です

## カスタムプロンプト管理

アプリケーション内でプロンプトを編集、保存、管理できます。

1. 「プロンプト編集」セクションで既存のプロンプトを選択するか、新規作成します
2. プロンプト内容を編集します（必ず `{transcription}` プレースホルダーを含めてください）
3. 「保存」ボタンをクリックして変更を適用します
4. 保存したプロンプトは「処理タイプ」ドロップダウンリストに自動的に追加されます

## ファイル構造

```
AI-transcription/
├── config/          # 設定ファイル
│   └── config.json  # APIキー、ウィンドウ設定など
├── data/            # データファイル
│   └── prompts.json # プロンプト設定
├── output/          # 出力ファイル保存先
├── src/             # ソースコード
│   ├── app.py       # メインアプリケーションロジック
│   ├── config.py    # 設定管理クラス
│   ├── processor.py # 音声処理とAPI連携クラス
│   └── ui.py        # ユーザーインターフェース
└── main.py          # エントリーポイント
```

## 出力形式

文字起こしや追加処理の結果は、以下の命名規則でテキストファイルとして `output/` ディレクトリに保存されます：
- 文字起こし: `[ファイル名]_文字起こし_[タイムスタンプ].txt`
- 追加処理: `[ファイル名]_[処理タイプ]_[タイムスタンプ].txt`

## 注意事項

### Gemini使用時
- Google Gemini APIキーが必要です
- APIの利用制限や課金については、Google Gemini APIの公式ドキュメントを確認してください
- インターネット接続が必要です

### Whisper使用時
- 初回実行時にモデルのダウンロードが必要です（サイズ: 39MB～1.5GB）
- GPU（CUDA対応）があると処理速度が大幅に向上します
- オフラインで動作可能です
- 完全無料で利用できます

### 共通
- 大きなファイルの処理には時間がかかる場合があります
- 処理中はアプリケーションが応答しなくなる場合がありますが、バックグラウンドで処理は継続します

## トラブルシューティング

- **文字起こし結果が空または不正確**: API接続を確認し、音声ファイルの品質を確認してください
- **追加処理が機能しない**: プロンプト内に `{transcription}` プレースホルダーが含まれているか確認してください
- **ドラッグ＆ドロップが機能しない**: tkinterdnd2ライブラリがインストールされているか確認してください
- **エラーメッセージが表示される**: ログメッセージを確認し、必要に応じてFFmpegがインストールされているか確認してください

## 改良履歴

- ファイル構造の整理: 設定・データファイルを適切なディレクトリに配置
- UI/UXの改善: ドラッグ＆ドロップ機能の強化、ファイル選択方法の明確化
- 処理フローの最適化: 「文字起こし」と「追加処理」を分離
- Gemini API連携強化: 適切なモデル自動選択、音声ファイル圧縮処理
- プロンプト管理: 保存・編集インターフェースの改善、マークダウン形式のサポート強化
- **Whisperサポート追加**: ローカル/オフライン文字起こし機能の実装（2025年）
  - エンジン選択機能（Gemini/Whisper）
  - Whisperモデルサイズ選択（tiny～large）
  - GPU自動検出と高速化
