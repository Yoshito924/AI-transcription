# エラーガイド - よくあるエラーと対処法

このドキュメントは、文字起こしアプリケーションで発生する可能性のあるエラーと、その対処法をまとめたものです。

## セグメント処理エラー

音声ファイルが長い場合、複数のセグメントに分割して処理します。セグメント処理中にエラーが発生した場合、以下のようなメッセージが表示されます:

```
[セグメント 1 処理エラー: 安全性フィルター - 応答が安全性フィルターによってブロックされました]
```

### 1. 安全性フィルターエラー

**エラーメッセージ:**
```
セグメント X 処理エラー: 安全性フィルター
詳細: 音声の内容が安全性基準に抵触する可能性があります
```

**原因:**
- 音声に過激な表現や不適切なコンテンツが含まれている
- Google Gemini APIの安全性フィルターが反応した

**対処法:**
- 音声の内容を確認してください
- 過激な表現や不適切なコンテンツが含まれている場合、処理できません
- 問題のある箇所を編集・削除してから再度実行してください

---

### 2. サーバーエラー (InternalServerError / 500 Exception)

**エラーメッセージ:**
```
セグメント X 処理エラー: サーバーエラー
詳細: InternalServerError - 500 Exception deserializing response
```

**原因:**
- Google側のサーバーで一時的な問題が発生している
- API側の内部エラー

**対処法:**
- **最も効果的:** 数分待ってから再度実行してください
- 複数回エラーが続く場合は、時間を空けて再試行してください
- Google APIのステータスページを確認してください: https://status.cloud.google.com/

---

### 3. 著作権保護コンテンツエラー

**エラーメッセージ:**
```
セグメント X 処理エラー: 著作権保護コンテンツ
詳細: 音楽や著作権保護されたコンテンツが検出されました
```

**原因:**
- 音声にBGM、音楽、著作権保護されたコンテンツが含まれている
- 既存のコンテンツの録音・録画が含まれている

**対処法:**
- 音声に含まれる音楽やBGMを削除してください
- 著作権フリーの音声のみを使用してください
- 別の音声ファイルを使用してください

---

### 4. APIレート制限エラー

**エラーメッセージ:**
```
セグメント X 処理エラー: APIレート制限
詳細: APIの呼び出し回数が上限に達しました
```

**原因:**
- 短時間に大量のAPI呼び出しを行った
- 無料プランの上限に達した

**対処法:**
- 数分待ってから再度実行してください
- 無料プランの場合、有料プランへのアップグレードをご検討ください
- セグメント数の多いファイルの場合、時間を空けて処理してください

---

### 5. タイムアウトエラー

**エラーメッセージ:**
```
セグメント X 処理エラー: タイムアウト
詳細: API応答に時間がかかりすぎました
```

**原因:**
- 音声の内容が複雑すぎる
- ネットワークが不安定

**対処法:**
- しばらく待ってから再度実行してください
- ネットワーク接続を確認してください
- 音声ファイルの品質を下げて再試行してください

---

### 6. ネットワーク接続エラー

**エラーメッセージ:**
```
セグメント X 処理エラー: ネットワーク接続
詳細: インターネット接続に問題があります
```

**原因:**
- インターネット接続が切断されている
- ネットワークが不安定

**対処法:**
- ネットワーク接続を確認してください
- Wi-Fi接続を確認してください
- ルーターを再起動してください

---

### 7. 認証失敗エラー

**エラーメッセージ:**
```
セグメント X 処理エラー: 認証失敗
詳細: APIキーが無効または権限がありません
```

**原因:**
- APIキーが正しくない
- APIキーの権限が不足している

**対処法:**
- APIキーが正しく設定されているか確認してください
- Google Cloud Consoleでキーを再生成してください
- Gemini APIが有効になっているか確認してください

---

## エラーログファイル

エラーが発生すると、以下のファイルが生成されます:

### 1. セグメント別エラーログ
- ファイル名: `segment_X_error.log`
- 場所: 一時ディレクトリ (通常は `C:\Users\[ユーザー名]\AppData\Local\Temp`)
- 内容: 各セグメントの詳細なエラー情報

### 2. エラーサマリー
- ファイル名: `transcription_errors_YYYYMMDD_HHMMSS.json`
- 場所: 音声ファイルと同じディレクトリ
- 内容: 全セグメントのエラー統計と推奨事項

**エラーサマリーの例:**
```json
{
  "summary": {
    "total_segments": 10,
    "failed_segments": 2,
    "success_segments": 8,
    "success_rate": "80.0%"
  },
  "errors": [
    {
      "segment_index": 1,
      "error_text": "[セグメント 1 処理エラー: 安全性フィルター - 音声の内容が安全性基準に抵触する可能性があります]"
    }
  ],
  "recommendations": [
    "エラーが発生したセグメントは文字起こし結果に含まれていません。",
    "エラーの詳細は各セグメントのエラーログファイルを確認してください。",
    "エラーが続く場合は、音声ファイルの内容や品質を確認してください。"
  ]
}
```

---

## トラブルシューティング

### エラーが続く場合

1. **音声ファイルを確認**
   - ファイルが破損していないか
   - 音質が適切か
   - 不適切なコンテンツが含まれていないか

2. **別のエンジンを試す**
   - Geminiでエラーが続く場合、Whisper (ローカル) を試してください
   - Whisperは安全性フィルターがないため、より多くの音声を処理できます

3. **音声を編集**
   - 問題のある箇所を特定して削除
   - BGMや音楽を削除
   - 音質を調整

4. **ログを確認**
   - エラーログファイルで詳細を確認
   - エラーサマリーで全体像を把握

---

## サポート

上記の対処法でも解決しない場合は、以下の情報を含めて問い合わせてください:

- エラーメッセージ全文
- エラーログファイルの内容
- 音声ファイルの長さとサイズ
- 使用したエンジン (Gemini / Whisper)
- エラー発生時の状況

---

**最終更新:** 2025-10-10
